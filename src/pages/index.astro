---
import { getCollection } from "astro:content";
import Permalink from "../components/Permalink.astro";
import { SITE_DESCRIPTION, SITE_TITLE, WORDS_PER_MINUTE } from "../consts";
import Layout from "../layouts/Layout.astro";
import { formatDate } from "../lib/utils";

const collection = await getCollection("posts");
const posts = collection
  .filter((a) => !a.data.isDraft)
  .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf());
const post = posts[0];
const { Content } = await post.render();
const raw = post.body;
const clean = raw.replace(/<\/?[^>]+(>|$)/g, "");
const numberOfWords = clean.split(/\s/g).length;
const amount = Math.ceil(numberOfWords / WORDS_PER_MINUTE);
---

<Layout
  title={SITE_TITLE}
  description={SITE_DESCRIPTION}
  className="flex h-svh flex-col"
>
  <main class="space-y-4">
    <h1 class="mb-5 text-xl font-medium">
      {post.data.title}
      <Permalink linkaddress={`posts/${post.slug}`} />
    </h1>
    <p class="mb-1 font-medium text-zinc-500">
      {formatDate(post.data.date)}
    </p>
    <p class="mb-1 font-medium text-zinc-500">
      {`${amount} minute read`}
    </p>
    <article>
      <Content />
    </article>
  </main>
  <hr class="rounded" />
  <div class="flex items-center justify-between py-4" transition:name="header">
    <a href="/posts"> other posts </a>
  </div>
</Layout>

<style>
  a {
    @apply font-medium text-zinc-500 hover:text-zinc-900 hover:underline dark:hover:text-zinc-100;
  }
</style>
